<dataConfig>
    <dataSource driver="com.mysql.jdbc.Driver" url="jdbc:mysql://127.0.0.1/dop" user="root" password="root" readOnly="true" />
    <document>
        <!--
            Primary key (uniqueKey) has to be unique amoung all entities, so we have to generate it using the pair (type, id).
            deltaQuery: must return uniqueKey which will be used to match the changed entity (in db) with the Solr index.
                        nust return the database id to be used in the deltaImportQuery.
            deletedPkQuery: must return uniqueKey which will be used to remove document from Solr index.
         -->
        <entity name="Material" pk="uniqueKey"
            query="select concat('material', id ) as uniqueKey, id, licenseType, paid, 'material' as type, lang, isSpecialEducation as special_education, issueDate as issue_date_id, recommendation, curriculumLiterature as curriculum_literature from Material WHERE deleted = false"
            deltaImportQuery="select concat('material', id ) as uniqueKey, id, licenseType, paid, 'material' as type, lang, isSpecialEducation as special_education, issueDate as issue_date_id, recommendation, curriculumLiterature as curriculum_literature from Material where id = '${dih.delta.id}'"
            deltaQuery="select concat('material', id ) as uniqueKey, id from Material where (CONVERT_TZ(added, @@session.time_zone, '+00:00') > '${dataimporter.last_index_time}' OR CONVERT_TZ(updated, @@session.time_zone, '+00:00') > '${dataimporter.last_index_time}') AND deleted = false"
            deletedPkQuery="select concat('material', id ) as uniqueKey from Material where (CONVERT_TZ(added, @@session.time_zone, '+00:00') > '${dataimporter.last_index_time}' OR CONVERT_TZ(updated, @@session.time_zone, '+00:00') > '${dataimporter.last_index_time}') AND deleted = true">
            
            <entity name="Material_Title" query="select title as title_id from Material_Title where material='${Material.id}'">
                <entity name="LanguageString" query="select textValue as title from LanguageString where id = '${Material_Title.title_id}'" />
            </entity>

            <entity name="Material_Description" query="select description as description_id from Material_Description where material='${Material.id}'">
                <entity name="LanguageString" query="select textValue as description from LanguageString where id = '${Material_Description.description_id}'" />
            </entity>

            <entity name="Material_Author" query="select author as author_id from Material_Author where material='${Material.id}'">
                <entity name="Author" query="select concat(name, ' ', surname) as fullname from Author where id = '${Material_Author.author_id}'">
                    <field column="fullname" name="author" />
                </entity>
            </entity>

            <entity name="Material_Tag" query="select tag as tag_id from Material_Tag where material='${Material.id}'">
                <entity name="Tag" query="select name as tag from Tag where id = '${Material_Tag.tag_id}'" />
            </entity>

            <entity name="TagUpVote" query="select concat(t.name, '_', count(*)) as tag_up_vote from TagUpVote tuv, Tag t where tuv.tag = t.id AND tuv.material = '${Material.id}' GROUP BY name" />

            <entity name="Material_Recommended" query="select if ((select recommendation from Material where id='${Material.id}') is not null, 1, 0) as recommended" />
            
            <entity name="Material_Recommendatation_Timestamp" query="select added as recommendation_timestamp from Recommendation where id = '${Material.recommendation}'" />

            <entity name="Material_Taxon" query="select taxon as taxon_id from Material_Taxon where material = '${Material.id}'">
                <!-- Travel up the taxon path -->

                <!-- Get subtopic -->
                <entity name="Subtopic" query="select t.id, t.name as subtopic, st.topic as parent from Taxon t left join Subtopic st on t.id = st.id where t.level = 'SUBTOPIC' and t.id = '${Material_Taxon.taxon_id}'">

                    <!-- Get topic -->
                    <entity name="Topic" query="select t.id, t.name as topic, top.module as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Subtopic.parent}'">

                        <!-- Get module -->
                        <entity name="Module" query="select t.id, t.name as module, m.specialization as parent from Taxon t left join Module m on t.id = m.id where t.level = 'MODULE' and t.id = '${Topic.parent}'">

                            <!-- Get specialization -->
                            <entity name="Specialization" query="select t.id, t.name as specialization, s.domain as parent from Taxon t left join Specialization s on t.id = s.id where t.level = 'SPECIALIZATION' and t.id = '${Module.parent}'">

                                <!-- Get domain -->
                                <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Specialization.parent}'">
                                    
                                    <!-- Get educational context -->
                                    <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                                        <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                                    </entity>
                                </entity>
                            </entity>
                        </entity>
                    </entity>
                </entity>

                <!-- Get topic -->
                <entity name="Topic" query="select t.id, t.name as topic, top.module as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Material_Taxon.taxon_id}'">

                    <!-- Get module -->
                    <entity name="Module" query="select t.id, t.name as module, m.specialization as parent from Taxon t left join Module m on t.id = m.id where t.level = 'MODULE' and t.id = '${Topic.parent}'">

                        <!-- Get specialization -->
                        <entity name="Specialization" query="select t.id, t.name as specialization, s.domain as parent from Taxon t left join Specialization s on t.id = s.id where t.level = 'SPECIALIZATION' and t.id = '${Module.parent}'">

                            <!-- Get domain -->
                            <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Specialization.parent}'">
                                
                                <!-- Get educational context -->
                                <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                                    <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                                </entity>
                            </entity>
                        </entity>
                    </entity>
                </entity>

                <!-- Get module -->
                <entity name="Module" query="select t.id, t.name as module, m.specialization as parent from Taxon t left join Module m on t.id = m.id where t.level = 'MODULE' and t.id = '${Material_Taxon.taxon_id}'">

                    <!-- Get specialization -->
                    <entity name="Specialization" query="select t.id, t.name as specialization, s.domain as parent from Taxon t left join Specialization s on t.id = s.id where t.level = 'SPECIALIZATION' and t.id = '${Module.parent}'">

                        <!-- Get domain -->
                        <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Specialization.parent}'">
                            
                            <!-- Get educational context -->
                            <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                                <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                            </entity>
                        </entity>
                    </entity>
                </entity>

                <!-- Get specialization -->
                <entity name="Specialization" query="select t.id, t.name as specialization, s.domain as parent from Taxon t left join Specialization s on t.id = s.id where t.level = 'SPECIALIZATION' and t.id = '${Material_Taxon.taxon_id}'">

                    <!-- Get domain -->
                    <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Specialization.parent}'">
                        
                        <!-- Get educational context -->
                        <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                            <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                        </entity>
                    </entity>
                </entity>

                <!-- Get subtopic -->
                <entity name="Subtopic" query="select t.id, t.name as subtopic, st.topic as parent from Taxon t left join Subtopic st on t.id = st.id where t.level = 'SUBTOPIC' and t.id = '${Material_Taxon.taxon_id}'">

                    <!-- Get topic -->
                    <entity name="Topic" query="select t.id, t.name as topic, top.domain as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Subtopic.parent}'">

                        <!-- Get domain -->
                        <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Topic.parent}'">
                            
                            <!-- Get educational context -->
                            <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                                <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                            </entity>
                        </entity>
                    </entity>
                </entity>

                <!-- Get topic -->
                <entity name="Topic" query="select t.id, t.name as topic, top.domain as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Material_Taxon.taxon_id}'">

                    <!-- Get domain -->
                    <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Topic.parent}'">
                        
                        <!-- Get educational context -->
                        <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                            <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                        </entity>
                    </entity>
                </entity>

                <!-- Get subtopic -->
                <entity name="Subtopic" query="select t.id, t.name as subtopic, st.topic as parent from Taxon t left join Subtopic st on t.id = st.id where t.level = 'SUBTOPIC' and t.id = '${Material_Taxon.taxon_id}'">

                    <!-- Get topic -->
                    <entity name="Topic" query="select t.id, t.name as topic, top.subject as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Subtopic.parent}'">

                        <!-- Get subject -->
                        <entity name="Subject" query="select t.id, t.name as subject, s.domain as parent from Taxon t left join Subject s on t.id = s.id where t.level = 'SUBJECT' and t.id = '${Topic.parent}'">
                            <entity name="Translation" query="select translation as subject from Translation where translationKey = 'SUBJECT_${Subject.subject}'" />

                            <!-- Get domain -->
                            <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Subject.parent}'">
                                
                                <!-- Get educational context -->
                                <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                                    <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                                </entity>
                            </entity>
                        </entity>
                    </entity>
                </entity>

                <!-- Get topic -->
                <entity name="Topic" query="select t.id, t.name as topic, top.subject as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Material_Taxon.taxon_id}'">

                    <!-- Get subject -->
                    <entity name="Subject" query="select t.id, t.name as subject, s.domain as parent from Taxon t left join Subject s on t.id = s.id where t.level = 'SUBJECT' and t.id = '${Topic.parent}'">
                        <entity name="Translation" query="select translation as subject from Translation where translationKey = 'SUBJECT_${Subject.subject}'" />

                        <!-- Get domain -->
                        <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Subject.parent}'">
                            
                            <!-- Get educational context -->
                            <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                                <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                            </entity>
                        </entity>
                    </entity>
                </entity>

                <!-- Get subject -->
                <entity name="Subject" query="select t.id, t.name as subject, s.domain as parent from Taxon t left join Subject s on t.id = s.id where t.level = 'SUBJECT' and t.id = '${Material_Taxon.taxon_id}'">
                    <entity name="Translation" query="select translation as subject from Translation where translationKey = 'SUBJECT_${Subject.subject}'" />

                    <!-- Get domain -->
                    <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Subject.parent}'">
                        
                        <!-- Get educational context -->
                        <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                            <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                        </entity>
                    </entity>
                </entity>

                <!-- Get domain -->
                <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Material_Taxon.taxon_id}'">
                    
                    <!-- Get educational context -->
                    <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                        <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                    </entity>
                </entity>

                <!-- Get educational context -->
                <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Material_Taxon.taxon_id}'">
                    <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                </entity>

            </entity>

            <entity name="Material_ResourceType" query="select resourceType as resourceType_id from Material_ResourceType where material='${Material.id}'">
                <entity name="ResourceType" query="select name as resource_type from ResourceType where id = '${Material_ResourceType.resourceType_id}'" />
            </entity>

            <entity name="LicenseType" query="select name as license_type from LicenseType where id='${Material.licenseType}'" />

            <entity name="Material_Language" query="select code as language from LanguageTable where id='${Material.lang}'" />

            <entity name="Material_TargetGroup" query="select targetGroup as target_group from Material_TargetGroup where material='${Material.id}'" />

            <entity name="IssueDate" query="select year as issue_date_year from IssueDate where id='${Material.issue_date_id}'" />

            <entity name="Material_CrossCurricularTheme" query="select crossCurricularTheme as cross_curricular_theme_id from Material_CrossCurricularTheme where material='${Material.id}'">
                <entity name="CrossCurricularTheme" query="select name as cross_curricular_theme from CrossCurricularTheme where id = '${Material_CrossCurricularTheme.cross_curricular_theme_id}'" />
            </entity>

            <entity name="Material_KeyCompetence" query="select keyCompetence as key_competence_id from Material_KeyCompetence where material='${Material.id}'">
                <entity name="KeyCompetence" query="select name as key_competence from KeyCompetence where id = '${Material_KeyCompetence.key_competence_id}'" />
            </entity>
        </entity>

        <entity name="Portfolio" pk="uniqueKey"
            query="select concat('portfolio', id ) as uniqueKey, id, title, summary, taxon as taxon_id, 'portfolio' as type, visibility, created, recommendation from Portfolio WHERE deleted = false" 
            deltaImportQuery="select concat('portfolio', id ) as uniqueKey, id, title, summary, taxon as taxon_id, 'portfolio' as type, visibility, created, recommendation from Portfolio where id = '${dih.delta.id}'" 
            deltaQuery="select concat('portfolio', id ) as uniqueKey, id from Portfolio where (CONVERT_TZ(created, @@session.time_zone, '+00:00') > '${dataimporter.last_index_time}' OR CONVERT_TZ(updated, @@session.time_zone, '+00:00') > '${dataimporter.last_index_time}') AND deleted = false" 
            deletedPkQuery="select concat('portfolio', id ) as uniqueKey, id from Portfolio where (CONVERT_TZ(created, @@session.time_zone, '+00:00') > '${dataimporter.last_index_time}' OR CONVERT_TZ(updated, @@session.time_zone, '+00:00') > '${dataimporter.last_index_time}') AND deleted = true">

            <!-- Travel up the taxon path -->

            <!-- Get subtopic -->
            <entity name="Subtopic" query="select t.id, t.name as subtopic, st.topic as parent from Taxon t left join Subtopic st on t.id = st.id where t.level = 'SUBTOPIC' and t.id = '${Portfolio.taxon_id}'">

                <!-- Get topic -->
                <entity name="Topic" query="select t.id, t.name as topic, top.module as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Subtopic.parent}'">

                    <!-- Get module -->
                    <entity name="Module" query="select t.id, t.name as module, m.specialization as parent from Taxon t left join Module m on t.id = m.id where t.level = 'MODULE' and t.id = '${Topic.parent}'">

                        <!-- Get specialization -->
                        <entity name="Specialization" query="select t.id, t.name as specialization, s.domain as parent from Taxon t left join Specialization s on t.id = s.id where t.level = 'SPECIALIZATION' and t.id = '${Module.parent}'">

                            <!-- Get domain -->
                            <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Specialization.parent}'">
                                
                                <!-- Get educational context -->
                                <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                                    <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                                </entity>
                            </entity>
                        </entity>
                    </entity>
                </entity>
            </entity>

            <!-- Get topic -->
            <entity name="Topic" query="select t.id, t.name as topic, top.module as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Portfolio.taxon_id}'">

                <!-- Get module -->
                <entity name="Module" query="select t.id, t.name as module, m.specialization as parent from Taxon t left join Module m on t.id = m.id where t.level = 'MODULE' and t.id = '${Topic.parent}'">

                    <!-- Get specialization -->
                    <entity name="Specialization" query="select t.id, t.name as specialization, s.domain as parent from Taxon t left join Specialization s on t.id = s.id where t.level = 'SPECIALIZATION' and t.id = '${Module.parent}'">

                        <!-- Get domain -->
                        <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Specialization.parent}'">
                            
                            <!-- Get educational context -->
                            <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                                <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                            </entity>
                        </entity>
                    </entity>
                </entity>
            </entity>

            <!-- Get module -->
            <entity name="Module" query="select t.id, t.name as module, m.specialization as parent from Taxon t left join Module m on t.id = m.id where t.level = 'MODULE' and t.id = '${Portfolio.taxon_id}'">

                <!-- Get specialization -->
                <entity name="Specialization" query="select t.id, t.name as specialization, s.domain as parent from Taxon t left join Specialization s on t.id = s.id where t.level = 'SPECIALIZATION' and t.id = '${Module.parent}'">

                    <!-- Get domain -->
                    <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Specialization.parent}'">
                        
                        <!-- Get educational context -->
                        <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                            <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                        </entity>
                    </entity>
                </entity>
            </entity>

            <!-- Get specialization -->
            <entity name="Specialization" query="select t.id, t.name as specialization, s.domain as parent from Taxon t left join Specialization s on t.id = s.id where t.level = 'SPECIALIZATION' and t.id = '${Portfolio.taxon_id}'">

                <!-- Get domain -->
                <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Specialization.parent}'">
                    
                    <!-- Get educational context -->
                    <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                        <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                    </entity>
                </entity>
            </entity>

            <!-- Get subtopic -->
            <entity name="Subtopic" query="select t.id, t.name as subtopic, st.topic as parent from Taxon t left join Subtopic st on t.id = st.id where t.level = 'SUBTOPIC' and t.id = '${Portfolio.taxon_id}'">

                <!-- Get topic -->
                <entity name="Topic" query="select t.id, t.name as topic, top.domain as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Subtopic.parent}'">

                    <!-- Get domain -->
                    <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Topic.parent}'">
                        
                        <!-- Get educational context -->
                        <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                            <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                        </entity>
                    </entity>
                </entity>
            </entity>

            <!-- Get topic -->
            <entity name="Topic" query="select t.id, t.name as topic, top.domain as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Portfolio.taxon_id}'">

                <!-- Get domain -->
                <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Topic.parent}'">
                    
                    <!-- Get educational context -->
                    <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                        <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                    </entity>
                </entity>
            </entity>

            <!-- Get subtopic -->
            <entity name="Subtopic" query="select t.id, t.name as subtopic, st.topic as parent from Taxon t left join Subtopic st on t.id = st.id where t.level = 'SUBTOPIC' and t.id = '${Portfolio.taxon_id}'">

                <!-- Get topic -->
                <entity name="Topic" query="select t.id, t.name as topic, top.subject as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Subtopic.parent}'">

                    <!-- Get subject -->
                    <entity name="Subject" query="select t.id, t.name as subject, s.domain as parent from Taxon t left join Subject s on t.id = s.id where t.level = 'SUBJECT' and t.id = '${Topic.parent}'">
                        <entity name="Translation" query="select translation as subject from Translation where translationKey = 'SUBJECT_${Subject.subject}'" />

                        <!-- Get domain -->
                        <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Subject.parent}'">
                            
                            <!-- Get educational context -->
                            <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                                <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                            </entity>
                        </entity>
                    </entity>
                </entity>
            </entity>

            <!-- Get topic -->
            <entity name="Topic" query="select t.id, t.name as topic, top.subject as parent from Taxon t left join Topic top on t.id = top.id where t.level = 'TOPIC' and t.id = '${Portfolio.taxon_id}'">

                <!-- Get subject -->
                <entity name="Subject" query="select t.id, t.name as subject, s.domain as parent from Taxon t left join Subject s on t.id = s.id where t.level = 'SUBJECT' and t.id = '${Topic.parent}'">
                    <entity name="Translation" query="select translation as subject from Translation where translationKey = 'SUBJECT_${Subject.subject}'" />

                    <!-- Get domain -->
                    <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Subject.parent}'">
                        
                        <!-- Get educational context -->
                        <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                            <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                        </entity>
                    </entity>
                </entity>
            </entity>

            <!-- Get subject -->
            <entity name="Subject" query="select t.id, t.name as subject, s.domain as parent from Taxon t left join Subject s on t.id = s.id where t.level = 'SUBJECT' and t.id = '${Portfolio.taxon_id}'">
                <entity name="Translation" query="select translation as subject from Translation where translationKey = 'SUBJECT_${Subject.subject}'" />

                <!-- Get domain -->
                <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Subject.parent}'">
                    
                    <!-- Get educational context -->
                    <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                        <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                    </entity>
                </entity>
            </entity>

            <!-- Get domain -->
            <entity name="Domain" query="select t.id, t.name as domain, d.educationalContext as parent from Taxon t left join Domain d on t.id = d.id where t.level = 'DOMAIN' and t.id = '${Portfolio.taxon_id}'">
                
                <!-- Get educational context -->
                <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Domain.parent}'">
                    <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
                </entity>
            </entity>

            <!-- Get educational context -->
            <entity name="EducationalContext" query="select name as educational_context from Taxon where level = 'EDUCATIONAL_CONTEXT' and id = '${Portfolio.taxon_id}'">
                <entity name="Translation" query="select translation as educational_context from Translation where translationKey = '${EducationalContext.educational_context}'" />
            </entity>

            <entity name="Portfolio_Tag" query="select tag as tag_id from Portfolio_Tag where portfolio='${Portfolio.id}'">
                <entity name="Tag" query="select name as tag from Tag where id = '${Portfolio_Tag.tag_id}'" />
            </entity>

            <entity name="Chapter" query="select title as chapterTitle, textValue as chapterText from Chapter where portfolio = '${Portfolio.id}' or parentChapter in (select id from Chapter where portfolio = '${Portfolio.id}')" />

            <entity name="Portfolio_TargetGroup" query="select targetGroup as target_group from Portfolio_TargetGroup where portfolio = '${Portfolio.id}'" />

            <entity name="Portfolio_CrossCurricularTheme" query="select crossCurricularTheme as cross_curricular_theme_id from Portfolio_CrossCurricularTheme where portfolio='${Portfolio.id}'">
                <entity name="CrossCurricularTheme" query="select name as cross_curricular_theme from CrossCurricularTheme where id = '${Portfolio_CrossCurricularTheme.cross_curricular_theme_id}'" />
            </entity>

            <entity name="Portfolio_KeyCompetence" query="select keyCompetence as key_competence_id from Portfolio_KeyCompetence where portfolio='${Portfolio.id}'">
                <entity name="KeyCompetence" query="select name as key_competence from KeyCompetence where id = '${Portfolio_KeyCompetence.key_competence_id}'" />
            </entity>

            <entity name="Portfolio_Recommended" query="select if ((select recommendation from Portfolio where id='${Portfolio.id}') is not null, 1, 0) as recommended" />
            
            <entity name="Portfolio_Recommendatation_Timestamp" query="select added as recommendation_timestamp from Recommendation where id = '${Portfolio.recommendation}'" />
        </entity>
    </document>
</dataConfig>